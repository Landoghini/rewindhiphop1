function handleLinkChange(e){var t=ytVidId(e.getValue()),n=ytVidTime(e.getValue());if(e.getValue().length>0?e.getDialog().getContentElement("youtubePlugin","txtEmbed").disable():e.getDialog().getContentElement("youtubePlugin","txtEmbed").enable(),t&&n){var l=timeParamToSeconds(n),u=secondsToHms(l);e.getDialog().getContentElement("youtubePlugin","txtStartAt").setValue(u)}}function handleEmbedChange(e){e.getValue().length>0?e.getDialog().getContentElement("youtubePlugin","txtUrl").disable():e.getDialog().getContentElement("youtubePlugin","txtUrl").enable()}function ytVidId(e){var t=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;return!!e.match(t)&&RegExp.$1}function ytVidTime(e){var t=/t=([0-9hms]+)/;return!!e.match(t)&&RegExp.$1}function hmsToSeconds(e){for(var t=e.split(":"),n=0,l=1;t.length>0;)n+=l*parseInt(t.pop(),10),l*=60;return n}function secondsToHms(e){var t=Math.floor(e/3600),n=Math.floor(e/60%60),l=e%60,u=function(e){return e=String(e),e.length>=2?e:"0"+e};return t>0?u(t)+":"+u(n)+":"+u(l):u(n)+":"+u(l)}function timeParamToSeconds(e){var t=function(t){var n=new RegExp("(\\d+)"+t);return e.match(n)?parseInt(RegExp.$1,10):0};return 3600*t("h")+60*t("m")+t("s")}function secondsToTimeParam(e){var t=Math.floor(e/3600),n=Math.floor(e/60%60),l=e%60,u="";return t>0&&(u+=t+"h"),n>0&&(u+=n+"m"),l>0&&(u+=l+"s"),u}!function(){CKEDITOR.plugins.add("youtube",{lang:["en","pt","pt-br","ja","hu","it","fr","tr","ru","de","ar","nl","pl","vi","zh","el","he","es","nb","nn","fi","et","sk","cs","ko"],init:function(e){e.addCommand("youtube",new CKEDITOR.dialogCommand("youtube",{allowedContent:"div{*}(*); iframe{*}[!width,!height,!src,!frameborder,!allowfullscreen]; object param[*]; a[*]; img[*]"})),e.ui.addButton("Youtube",{label:e.lang.youtube.button,toolbar:"insert",command:"youtube",icon:this.path+"images/icon.png"}),CKEDITOR.dialog.add("youtube",function(){var t,n=e.config.youtube_disabled_fields||[];return{title:e.lang.youtube.title,minWidth:510,minHeight:200,onShow:function(){for(var e=0;e<n.length;e++)this.getContentElement("youtubePlugin",n[e]).disable()},contents:[{id:"youtubePlugin",expand:!0,elements:[{id:"txtEmbed",type:"textarea",label:e.lang.youtube.txtEmbed,onChange:function(e){handleEmbedChange(this,e)},onKeyUp:function(e){handleEmbedChange(this,e)},validate:function(){if(this.isEnabled()){if(!this.getValue())return alert(e.lang.youtube.noCode),!1;if(0===this.getValue().length||-1===this.getValue().indexOf("//"))return alert(e.lang.youtube.invalidEmbed),!1}}},{type:"html",html:e.lang.youtube.or+"<hr>"},{type:"hbox",widths:["70%","15%","15%"],children:[{id:"txtUrl",type:"text",label:e.lang.youtube.txtUrl,onChange:function(e){handleLinkChange(this,e)},onKeyUp:function(e){handleLinkChange(this,e)},validate:function(){if(this.isEnabled()){if(!this.getValue())return alert(e.lang.youtube.noCode),!1;if(t=ytVidId(this.getValue()),0===this.getValue().length||!1===t)return alert(e.lang.youtube.invalidUrl),!1}}},{type:"text",id:"txtWidth",width:"60px",label:e.lang.youtube.txtWidth,"default":null!=e.config.youtube_width?e.config.youtube_width:"640",validate:function(){return this.getValue()?0===(parseInt(this.getValue())||0)?(alert(e.lang.youtube.invalidWidth),!1):void 0:(alert(e.lang.youtube.noWidth),!1)}},{type:"text",id:"txtHeight",width:"60px",label:e.lang.youtube.txtHeight,"default":null!=e.config.youtube_height?e.config.youtube_height:"360",validate:function(){return this.getValue()?0===(parseInt(this.getValue())||0)?(alert(e.lang.youtube.invalidHeight),!1):void 0:(alert(e.lang.youtube.noHeight),!1)}}]},{type:"hbox",widths:["55%","45%"],children:[{id:"chkResponsive",type:"checkbox",label:e.lang.youtube.txtResponsive,"default":null!=e.config.youtube_responsive&&e.config.youtube_responsive},{id:"chkNoEmbed",type:"checkbox",label:e.lang.youtube.txtNoEmbed,"default":null!=e.config.youtube_noembed&&e.config.youtube_noembed}]},{type:"hbox",widths:["55%","45%"],children:[{id:"chkRelated",type:"checkbox","default":null==e.config.youtube_related||e.config.youtube_related,label:e.lang.youtube.chkRelated},{id:"chkOlderCode",type:"checkbox","default":null!=e.config.youtube_older&&e.config.youtube_older,label:e.lang.youtube.chkOlderCode}]},{type:"hbox",widths:["55%","45%"],children:[{id:"chkPrivacy",type:"checkbox",label:e.lang.youtube.chkPrivacy,"default":null!=e.config.youtube_privacy&&e.config.youtube_privacy},{id:"chkAutoplay",type:"checkbox","default":null!=e.config.youtube_autoplay&&e.config.youtube_autoplay,label:e.lang.youtube.chkAutoplay}]},{type:"hbox",widths:["55%","45%"],children:[{id:"txtStartAt",type:"text",label:e.lang.youtube.txtStartAt,validate:function(){if(this.getValue()){var t=this.getValue();if(!/^(?:(?:([01]?\d|2[0-3]):)?([0-5]?\d):)?([0-5]?\d)$/i.test(t))return alert(e.lang.youtube.invalidTime),!1}}},{id:"chkControls",type:"checkbox","default":null==e.config.youtube_controls||e.config.youtube_controls,label:e.lang.youtube.chkControls}]}]}],onOk:function(){var e="",n="";if(this.getContentElement("youtubePlugin","txtEmbed").isEnabled())e=this.getValueOf("youtubePlugin","txtEmbed");else{var l,u="https://",o=[],i=this.getValueOf("youtubePlugin","txtWidth"),a=this.getValueOf("youtubePlugin","txtHeight");if(!0===this.getContentElement("youtubePlugin","chkPrivacy").getValue()?u+="www.youtube-nocookie.com/":u+="www.youtube.com/",u+="embed/"+t,!1===this.getContentElement("youtubePlugin","chkRelated").getValue()&&o.push("rel=0"),!0===this.getContentElement("youtubePlugin","chkAutoplay").getValue()&&o.push("autoplay=1"),!1===this.getContentElement("youtubePlugin","chkControls").getValue()&&o.push("controls=0"),l=this.getValueOf("youtubePlugin","txtStartAt")){var g=hmsToSeconds(l);o.push("start="+g)}if(o.length>0&&(u=u+"?"+o.join("&")),!0===this.getContentElement("youtubePlugin","chkResponsive").getValue()&&(e+='<div class="youtube-embed-wrapper" style="position:relative;padding-bottom:56.25%;padding-top:30px;height:0;overflow:hidden">',n='style="position:absolute;top:0;left:0;width:100%;height:100%"'),!0===this.getContentElement("youtubePlugin","chkOlderCode").getValue())u=u.replace("embed/","v/"),u=u.replace(/&/g,"&amp;"),-1===u.indexOf("?")?u+="?":u+="&amp;",u+="hl="+(this.getParentEditor().config.language?this.getParentEditor().config.language:"en")+"&amp;version=3",e+='<object width="'+i+'" height="'+a+'" '+n+">",e+='<param name="movie" value="'+u+'"></param>',e+='<param name="allowFullScreen" value="true"></param>',e+='<param name="allowscriptaccess" value="always"></param>',e+='<embed src="'+u+'" type="application/x-shockwave-flash" ',e+='width="'+i+'" height="'+a+'" '+n+' allowscriptaccess="always" ',e+='allowfullscreen="true"></embed>',e+="</object>";else if(!0===this.getContentElement("youtubePlugin","chkNoEmbed").getValue()){var h="//img.youtube.com/vi/"+t+"/sddefault.jpg";e+='<a href="'+u+'" ><img width="'+i+'" height="'+a+'" src="'+h+'" '+n+"/></a>"}else e+='<iframe width="'+i+'" height="'+a+'" src="'+u+'" '+n,e+='frameborder="0" allowfullscreen></iframe>';!0===this.getContentElement("youtubePlugin","chkResponsive").getValue()&&(e+="</div>")}var d=CKEDITOR.dom.element.createFromHtml(e);this.getParentEditor().insertElement(d)}}})}})}();